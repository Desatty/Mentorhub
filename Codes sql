1. Какое количество менторов и менти взаимодействуют каждый месяц на нашей платформе? Как меняется этот показатель из месяца в месяц? Даже если сессия не состоялась, это показывает активность. 

# начнем с запроса, который группирует данные по месяцам и считает количество уникальных менторов и менти.
select date_trunc('month', session_date_time) as month,
        count(distinct mentor_id) as unique_mentors,
        count(distinct mentee_id) as unique_mentees
    from
        sessions
    group by
        month
    order by
        month
# обернем этот запрос в CTE, чтобы затем использовать его результаты для вычисления изменений.
with monthly_actions as (
    select date_trunc('month', session_date_time) as month,
        count(distinct mentor_id) as unique_mentors,
        count(distinct mentee_id) as unique_mentees
    from
        sessions
    group by
        month
    order by
        month
)
# функция LAG() для получения значений за предыдущий месяц и вычисления разницы.
select month,
    unique_mentors,
    unique_mentees,
    lag(unique_mentors) over (order by month) AS previous_month_mentors,
    lag(unique_mentees) over (order by month) AS previous_month_mentees,
    (unique_mentors - lag(unique_mentors) over (order by month)) as mentor_change,
    (unique_mentees - lag(unique_mentees) over (order by month)) as mentee_change
FROM
    monthly_actions

# полный запрос
with monthly_actions as (
    select date_trunc('month', session_date_time) as month,
        count(distinct mentor_id) as unique_mentors,
        count(distinct mentee_id) as unique_mentees
    from
        sessions
    group by
        month
    order by
        month
)
select month,
    unique_mentors,
    unique_mentees,
    lag(unique_mentors) over (order by month) AS previous_month_mentors,
    lag(unique_mentees) over (order by month) AS previous_month_mentees,
    (unique_mentors - lag(unique_mentors) over (order by month)) as mentor_change,
    (unique_mentees - lag(unique_mentees) over (order by month)) as mentee_change
FROM
    monthly_actions


